{% extends "projects/base.html" %}

{% block content %}
<h1>{{ page_title }}</h1>

<h2>Your Tasks ({{ tasks.count }})</h2>

<ol class="menu">
    {% if not request.GET.status %}
        <li class="selected">Current</li>
    {% else %}
        <li><a href="?">Current</a></li>
    {% endif %}

    {% ifequal request.GET.status "completed" %}
        <li class="selected">Completed</li>
    {% else %}
        <li><a href="?status=completed">Completed</a></li>
    {% endifequal %}
</ol>

<form action="" method="post">
<p>{{ form.name }} <input type="submit" value="Add Task" /></p>
</form>

{% if tasks %}
    <form action="" method="post">
    {% ifequal request.GET.status "completed" %}
        {% regroup tasks by closed_on_date as tasks_by_date %}
        {% for date in tasks_by_date %}
            <p>{{ date.grouper|date:"F j, Y" }}</p>
            <ol>
            {% for task in date.list %}
                <li>
                    <input type="checkbox" id="task_{{ task.id }}" name="task" value="{{ task.id }}" />
                    <label class="task closed" for="task_{{ task.id }}">{{ task.name }}</label>
                </li>
            {% endfor %}
            </ol>
        {% endfor %}
    {% else %}
        <p>
            <input type="submit" name="mark_complete" value="Mark Complete" />
            <input type="submit" name="delete" value="Delete" />
        </p>
        <ol>
        {% for task in tasks %}
            <li>
                <input type="checkbox" id="task_{{ task.id }}" name="task" value="{{ task.id }}" />
                <label for="task_{{ task.id }}">{{ task.name }}</label>
            </li>
        {% endfor %}
        </ol>
    {% endifequal %}
    </form>
{% endif %}
{% endblock %}
